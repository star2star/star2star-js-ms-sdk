/* global require module*/
"use strict";

require("core-js/modules/es6.array.copy-within");

require("core-js/modules/es6.array.every");

require("core-js/modules/es6.array.fill");

require("core-js/modules/es6.array.filter");

require("core-js/modules/es6.array.find");

require("core-js/modules/es6.array.find-index");

require("core-js/modules/es6.array.for-each");

require("core-js/modules/es6.array.from");

require("core-js/modules/es7.array.includes");

require("core-js/modules/es6.array.index-of");

require("core-js/modules/es6.array.is-array");

require("core-js/modules/es6.array.iterator");

require("core-js/modules/es6.array.last-index-of");

require("core-js/modules/es6.array.map");

require("core-js/modules/es6.array.of");

require("core-js/modules/es6.array.reduce");

require("core-js/modules/es6.array.reduce-right");

require("core-js/modules/es6.array.some");

require("core-js/modules/es6.array.sort");

require("core-js/modules/es6.array.species");

require("core-js/modules/es6.date.now");

require("core-js/modules/es6.date.to-iso-string");

require("core-js/modules/es6.date.to-json");

require("core-js/modules/es6.date.to-primitive");

require("core-js/modules/es6.date.to-string");

require("core-js/modules/es6.function.bind");

require("core-js/modules/es6.function.has-instance");

require("core-js/modules/es6.function.name");

require("core-js/modules/es6.map");

require("core-js/modules/es6.math.acosh");

require("core-js/modules/es6.math.asinh");

require("core-js/modules/es6.math.atanh");

require("core-js/modules/es6.math.cbrt");

require("core-js/modules/es6.math.clz32");

require("core-js/modules/es6.math.cosh");

require("core-js/modules/es6.math.expm1");

require("core-js/modules/es6.math.fround");

require("core-js/modules/es6.math.hypot");

require("core-js/modules/es6.math.imul");

require("core-js/modules/es6.math.log1p");

require("core-js/modules/es6.math.log10");

require("core-js/modules/es6.math.log2");

require("core-js/modules/es6.math.sign");

require("core-js/modules/es6.math.sinh");

require("core-js/modules/es6.math.tanh");

require("core-js/modules/es6.math.trunc");

require("core-js/modules/es6.number.constructor");

require("core-js/modules/es6.number.epsilon");

require("core-js/modules/es6.number.is-finite");

require("core-js/modules/es6.number.is-integer");

require("core-js/modules/es6.number.is-nan");

require("core-js/modules/es6.number.is-safe-integer");

require("core-js/modules/es6.number.max-safe-integer");

require("core-js/modules/es6.number.min-safe-integer");

require("core-js/modules/es6.number.parse-float");

require("core-js/modules/es6.number.parse-int");

require("core-js/modules/es6.object.assign");

require("core-js/modules/es6.object.create");

require("core-js/modules/es7.object.define-getter");

require("core-js/modules/es7.object.define-setter");

require("core-js/modules/es6.object.define-property");

require("core-js/modules/es6.object.define-properties");

require("core-js/modules/es7.object.entries");

require("core-js/modules/es6.object.freeze");

require("core-js/modules/es6.object.get-own-property-descriptor");

require("core-js/modules/es7.object.get-own-property-descriptors");

require("core-js/modules/es6.object.get-own-property-names");

require("core-js/modules/es6.object.get-prototype-of");

require("core-js/modules/es7.object.lookup-getter");

require("core-js/modules/es7.object.lookup-setter");

require("core-js/modules/es6.object.prevent-extensions");

require("core-js/modules/es6.object.is");

require("core-js/modules/es6.object.is-frozen");

require("core-js/modules/es6.object.is-sealed");

require("core-js/modules/es6.object.is-extensible");

require("core-js/modules/es6.object.keys");

require("core-js/modules/es6.object.seal");

require("core-js/modules/es6.object.set-prototype-of");

require("core-js/modules/es7.object.values");

require("core-js/modules/es6.promise");

require("core-js/modules/es7.promise.finally");

require("core-js/modules/es6.reflect.apply");

require("core-js/modules/es6.reflect.construct");

require("core-js/modules/es6.reflect.define-property");

require("core-js/modules/es6.reflect.delete-property");

require("core-js/modules/es6.reflect.get");

require("core-js/modules/es6.reflect.get-own-property-descriptor");

require("core-js/modules/es6.reflect.get-prototype-of");

require("core-js/modules/es6.reflect.has");

require("core-js/modules/es6.reflect.is-extensible");

require("core-js/modules/es6.reflect.own-keys");

require("core-js/modules/es6.reflect.prevent-extensions");

require("core-js/modules/es6.reflect.set");

require("core-js/modules/es6.reflect.set-prototype-of");

require("core-js/modules/es6.regexp.constructor");

require("core-js/modules/es6.regexp.flags");

require("core-js/modules/es6.regexp.match");

require("core-js/modules/es6.regexp.replace");

require("core-js/modules/es6.regexp.split");

require("core-js/modules/es6.regexp.search");

require("core-js/modules/es6.regexp.to-string");

require("core-js/modules/es6.set");

require("core-js/modules/es6.symbol");

require("core-js/modules/es7.symbol.async-iterator");

require("core-js/modules/es6.string.anchor");

require("core-js/modules/es6.string.big");

require("core-js/modules/es6.string.blink");

require("core-js/modules/es6.string.bold");

require("core-js/modules/es6.string.code-point-at");

require("core-js/modules/es6.string.ends-with");

require("core-js/modules/es6.string.fixed");

require("core-js/modules/es6.string.fontcolor");

require("core-js/modules/es6.string.fontsize");

require("core-js/modules/es6.string.from-code-point");

require("core-js/modules/es6.string.includes");

require("core-js/modules/es6.string.italics");

require("core-js/modules/es6.string.iterator");

require("core-js/modules/es6.string.link");

require("core-js/modules/es7.string.pad-start");

require("core-js/modules/es7.string.pad-end");

require("core-js/modules/es6.string.raw");

require("core-js/modules/es6.string.repeat");

require("core-js/modules/es6.string.small");

require("core-js/modules/es6.string.starts-with");

require("core-js/modules/es6.string.strike");

require("core-js/modules/es6.string.sub");

require("core-js/modules/es6.string.sup");

require("core-js/modules/es6.string.trim");

require("core-js/modules/es6.typed.array-buffer");

require("core-js/modules/es6.typed.data-view");

require("core-js/modules/es6.typed.int8-array");

require("core-js/modules/es6.typed.uint8-array");

require("core-js/modules/es6.typed.uint8-clamped-array");

require("core-js/modules/es6.typed.int16-array");

require("core-js/modules/es6.typed.uint16-array");

require("core-js/modules/es6.typed.int32-array");

require("core-js/modules/es6.typed.uint32-array");

require("core-js/modules/es6.typed.float32-array");

require("core-js/modules/es6.typed.float64-array");

require("core-js/modules/es6.weak-map");

require("core-js/modules/es6.weak-set");

require("core-js/modules/web.timers");

require("core-js/modules/web.immediate");

require("core-js/modules/web.dom.iterable");

require("regenerator-runtime/runtime");

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

var utilities = require("./utilities");

var Objects = require("./objects");
/**
 *
 * @description This function will ask the cpaas data object service for a specific object.
 * @param {array} [tasks=[]] - array of tasks objects
 * @returns {object} - object containing status, message and tasks
 */


var validateTasks = function validateTasks() {
  var tasks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
  var rStatus = {
    status: 200,
    message: "valid",
    tasks: [].concat(tasks)
  }; //console.log(rStatus, tasks)

  if (tasks.length <= 0) {
    return rStatus;
  }

  tasks.forEach(function (t) {
    if (_typeof(t) !== "object") {
      //console.log(typeOf(t))
      rStatus.status = 400;
      rStatus.message = "all task must be an object";
    } else {
      // valid object
      ///console.log('a')
      if (!t.hasOwnProperty("title")) {
        rStatus.status = 400;
        rStatus.message = "task is missing title";
      } else {
        !t.hasOwnProperty("uuid") && (t.uuid = utilities.createUUID());
        !t.hasOwnProperty("note") && (t.note = []);
        !t.hasOwnProperty("status") && (t.status = "open"); //!t.owner && t.owner =
      }
    }
  });
  return rStatus;
};
/**
 * @async
 * @description This function will ask the cpaas data object service for a list of task_template objects.
 * @param {string} [userUUID="null user uuid"] - user UUID to be used
 * @param {string} [access_token="null access_token"] - access_token for cpaas systems
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a list of data object task templates with content
 */


var getTaskTemplates = function getTaskTemplates() {
  var userUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null user uuid";
  var access_token = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "null access_token";
  var trace = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  return Objects.getDataObjectByType(userUUID, access_token, "task_template", 0, //offset
  100, // limit TODO, this will need to go through utilities aggregator if we get more than 100
  true, trace);
};
/**
 * @async
 * @description This function will create a new task template object.
 * @param {string} [userUUID="null user uuid"] - user UUID to be used
 * @param {string} [access_token="null access_token"] - access_token for cpaas systems
 * @param {string} [title="missing-stuff"] - title of task template
 * @param {string} [description="task template description"] - description of task template
 * @param {array} [defaultTasks=[]] - array of objects; minimium is a title
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns
 */


var createTaskTemplate = function createTaskTemplate() {
  var userUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null user uuid";
  var access_token = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "null access_token";
  var title = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "missing-stuff";
  var description = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "task template description";
  var defaultTasks = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];
  var trace = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};
  var vTasks = validateTasks(defaultTasks);

  if (vTasks.status === 200) {
    return Objects.createUserDataObject(userUUID, access_token, title, "task_template", description, {
      tasks: vTasks.tasks
    }, undefined, //users for shared objects
    trace);
  } else {
    return Promise.reject(vTasks);
  }
};
/**
 * @async
 * @description This function will delete the task template object.
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [task_template_uuid="missing task uuid"] - data object UUID
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to an identity data object
 */


var deleteTaskTemplate = function deleteTaskTemplate() {
  var access_token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null access_token";
  var task_template_uuid = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "missing task uuid";
  var trace = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  return Objects.deleteDataObject(access_token, task_template_uuid, trace);
};
/**
 * @async
 * @description This function will create a task object (task_list).
 * @param {string} [userUUID="null user uuid"] - user UUID to be used
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [title="Missing Task Title"] - title of task object
 * @param {string} [description="task description default"] - title of task object
 * @param {array} [defaultTasks=[]] - array of objects; minimium is a title
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a task data object
 */


var createTaskObject = function createTaskObject() {
  var userUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null user uuid";
  var access_token = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "null access_token";
  var title = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "Missing Task Title";
  var description = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "task description default";
  var defaultTasks = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];
  var trace = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};
  var vTasks = validateTasks(defaultTasks);

  if (vTasks.status === 200) {
    return Objects.createUserDataObject(userUUID, access_token, title, "task_list", description, {
      tasks: vTasks.tasks
    }, undefined, //users for shared objects
    trace);
  } else {
    return Promise.reject(vTasks);
  }
};
/**
 * @async
 * @description This function will delete task list.
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [task_uuid="missing task uuid"] - task list UUID
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a data object
 */


var deleteTaskObject = function deleteTaskObject() {
  var access_token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null access_token";
  var task_uuid = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "missing task uuid";
  var trace = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  return Objects.deleteDataObject(access_token, task_uuid, trace);
};
/**
 * @async
 * @description This function will retrieve task list.
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [taskObjectUUID="null uuid" - task list UUID
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a task data object
 */


var getTaskObject = function getTaskObject() {
  var access_token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null access_token";
  var taskObjectUUID = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "null uuid";
  var trace = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  return Objects.getDataObject(access_token, taskObjectUUID, trace);
};
/**
 * @async
 * @description This function will update task list.
 * @param {string} [userUUID="null user uuid"] - user UUID
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [uuid="missing_uuid"] - task list UUID
 * @param {object} [taskObject={}]
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a task data object
 */


var updateTaskObject = function updateTaskObject() {
  var userUUID = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null user uuid";
  var access_token = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "null access_token";
  var uuid = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "missing_uuid";
  var taskObject = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
  var trace = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
  return Objects.updateDataObject(userUUID, access_token, uuid, taskObject, trace);
};
/**
 * @async
 * @description This function will add task to a task object.
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [taskObjectUUID="missing_uuid"] - task object UUID
 * @param {object} [task={}] - individual task
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a task data object
 */


var addTaskToTaskObject = function addTaskToTaskObject() {
  var access_token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null access_token";
  var taskObjectUUID = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "missing_uuid";
  var task = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var trace = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
  var vTasks = validateTasks([task]);

  if (vTasks.status === 200) {
    return Objects.getDataObject(access_token, taskObjectUUID, trace).then(function (rData) {
      //console.log(rData)
      rData.content.tasks = [].concat(rData.content.tasks, vTasks.tasks);
      return Objects.updateDataObject(access_token, taskObjectUUID, rData, utilities.generateNewMetaData(trace));
    });
  } else {
    return Promise.reject(vTasks);
  }
};
/**
 * @async
 * @description This function will update a task in a task object.
 * @param {string} [access_token="null access_token"] - access token for cpaas systems
 * @param {string} [taskObjectUUID="missing_uuid"] - task object UUID
 * @param {object} [task={}] - updated task object
 * @param {object} [trace = {}] - optional microservice lifecycle trace headers
 * @returns {Promise<object>} - Promise resolving to a task data object
 */


var updateTaskInTaskObject = function updateTaskInTaskObject() {
  var access_token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "null access_token";
  var taskObjectUUID = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "missing_uuid";
  var task = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var trace = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
  var vTasks = validateTasks([task]); //console.log('----', vTasks)

  if (vTasks.status === 200) {
    return Objects.getDataObject(access_token, taskObjectUUID, trace).then(function (rData) {
      rData.content.tasks = rData.content.tasks.filter(function (t) {
        return t.uuid !== vTasks.tasks[0].uuid;
      });
      rData.content.tasks = [].concat(rData.content.tasks, vTasks.tasks);
      return Objects.updateDataObject(access_token, taskObjectUUID, rData, utilities.generateNewMetaData(trace));
    });
  } else {
    return Promise.reject(vTasks);
  }
};

module.exports = {
  getTaskTemplates: getTaskTemplates,
  createTaskTemplate: createTaskTemplate,
  deleteTaskTemplate: deleteTaskTemplate,
  createTaskObject: createTaskObject,
  deleteTaskObject: deleteTaskObject,
  getTaskObject: getTaskObject,
  updateTaskObject: updateTaskObject,
  addTaskToTaskObject: addTaskToTaskObject,
  updateTaskInTaskObject: updateTaskInTaskObject
};